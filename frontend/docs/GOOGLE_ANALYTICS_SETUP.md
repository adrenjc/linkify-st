# Google Analytics é›†æˆæŒ‡å—

æœ¬é¡¹ç›®å·²é›†æˆ Google Analytics 4 (GA4) ç”¨äºæ”¶é›†ç”¨æˆ·è¡Œä¸ºæ•°æ®å’Œç½‘ç«™ä½¿ç”¨ç»Ÿè®¡ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å– Google Analytics æµ‹é‡ ID

1. è®¿é—® [Google Analytics](https://analytics.google.com/)
2. åˆ›å»ºæ–°çš„è´¦æˆ·ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
3. åˆ›å»ºæ–°çš„å±æ€§ï¼ˆç½‘ç«™ï¼‰
4. é€‰æ‹© "GA4" ä½œä¸ºå±æ€§ç±»å‹
5. å®Œæˆè®¾ç½®åï¼Œè·å–æµ‹é‡ IDï¼ˆæ ¼å¼ï¼š`G-XXXXXXXXXX`ï¼‰

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼š

```bash
# Google Analytics é…ç½®
GA_MEASUREMENT_ID=G-XXXXXXXXXX
```

å°† `G-XXXXXXXXXX` æ›¿æ¢ä¸ºæ‚¨å®é™…çš„æµ‹é‡ IDã€‚

### 3. é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
# æˆ–
yarn dev
```

## ğŸ“Š è¿½è¸ªçš„æ•°æ®

### è‡ªåŠ¨è¿½è¸ª

- **é¡µé¢æµè§ˆé‡**: ç”¨æˆ·è®¿é—®çš„æ¯ä¸ªé¡µé¢
- **ä¼šè¯æ•°æ®**: ç”¨æˆ·ä¼šè¯æ—¶é•¿ã€è·³å‡ºç‡ç­‰
- **è®¾å¤‡ä¿¡æ¯**: æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿã€è®¾å¤‡ç±»å‹
- **åœ°ç†ä½ç½®**: åŸºäº IP çš„å¤§è‡´åœ°ç†ä½ç½®ï¼ˆå·²åŒ¿ååŒ–ï¼‰

### çŸ­é“¾ç›¸å…³äº‹ä»¶

- **åˆ›å»ºçŸ­é“¾**: `create_short_link`
  - å‚æ•°ï¼šé“¾æ¥æ•°é‡
- **ç¼–è¾‘çŸ­é“¾**: `edit_short_link`
  - å‚æ•°ï¼šçŸ­é“¾ key
- **åˆ é™¤çŸ­é“¾**: `delete_short_link`
  - å‚æ•°ï¼šçŸ­é“¾ key
- **æŸ¥çœ‹ç‚¹å‡»è®°å½•**: `view_click_records`
  - å‚æ•°ï¼šçŸ­é“¾ key
- **æŸ¥çœ‹çŸ­é“¾è¯¦æƒ…**: `view_link_detail`
  - å‚æ•°ï¼šçŸ­é“¾ key

### ç”¨æˆ·è¡Œä¸ºäº‹ä»¶

- **ç”¨æˆ·ç™»å½•**: `login`
  - å‚æ•°ï¼šç™»å½•æ–¹å¼
- **ç”¨æˆ·ç™»å‡º**: `logout`
- **æœç´¢è¡Œä¸º**: `search`
  - å‚æ•°ï¼šæœç´¢å…³é”®è¯ã€ç»“æœæ•°é‡
- **é¡µé¢åœç•™æ—¶é—´**: `time_on_page`
  - å‚æ•°ï¼šé¡µé¢è·¯å¾„ã€åœç•™ç§’æ•°

### ç³»ç»Ÿäº‹ä»¶

- **API é”™è¯¯**: `api_error`
  - å‚æ•°ï¼šAPI ç«¯ç‚¹ã€çŠ¶æ€ç 
- **åŠŸèƒ½ä½¿ç”¨**: `feature_usage`
  - å‚æ•°ï¼šåŠŸèƒ½åç§°
- **æ€§èƒ½æŒ‡æ ‡**: `performance`
  - å‚æ•°ï¼šæŒ‡æ ‡åç§°ã€æ•°å€¼

## ğŸ”§ è‡ªå®šä¹‰è¿½è¸ª

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```tsx
import { useAnalytics } from '@/hooks/useAnalytics';

const MyComponent = () => {
  const { track } = useAnalytics();

  const handleButtonClick = () => {
    // è¿½è¸ªè‡ªå®šä¹‰äº‹ä»¶
    track.event('button_click', 'ui', 'header_cta');

    // è¿½è¸ªçŸ­é“¾ç›¸å…³äº‹ä»¶
    track.shortLink.create(2);

    // è¿½è¸ªç”¨æˆ·è¡Œä¸º
    track.user.search('å…³é”®è¯', 10);

    // è¿½è¸ªç³»ç»Ÿäº‹ä»¶
    track.system.featureUsage('advanced_search');
  };

  return <button onClick={handleButtonClick}>ç‚¹å‡»æˆ‘</button>;
};
```

### è®¾ç½®ç”¨æˆ·å±æ€§

```tsx
import { useAnalytics } from '@/hooks/useAnalytics';

const UserProfile = () => {
  const { setUser } = useAnalytics();

  useEffect(() => {
    // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
    setUser('user123', {
      user_type: 'premium',
      signup_date: '2024-01-01',
    });
  }, []);

  return <div>ç”¨æˆ·èµ„æ–™</div>;
};
```

## ğŸ›¡ï¸ éšç§ä¿æŠ¤

### å†…ç½®éšç§ä¿æŠ¤æªæ–½

- **IP åŒ¿ååŒ–**: è‡ªåŠ¨åŒ¿ååŒ–ç”¨æˆ· IP åœ°å€
- **æ— ä¸ªäººèº«ä»½ä¿¡æ¯**: ä¸æ”¶é›†å§“åã€é‚®ç®±ç­‰ä¸ªäººä¿¡æ¯
- **ç”¨æˆ·åŒæ„**: æ˜¾ç¤ºéšç§æ”¿ç­–é€šçŸ¥ï¼Œç”¨æˆ·å¯é€‰æ‹©æ‹’ç»è¿½è¸ª
- **æœ¬åœ°å­˜å‚¨**: ç”¨æˆ·åŒæ„çŠ¶æ€ä¿å­˜åœ¨æœ¬åœ°

### éšç§æ”¿ç­–ç»„ä»¶

é¡¹ç›®å·²åŒ…å«éšç§æ”¿ç­–é€šçŸ¥ç»„ä»¶ï¼Œä¼šåœ¨ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶æ˜¾ç¤ºï¼š

- ç”¨æˆ·å¯ä»¥é€‰æ‹©æ¥å—æˆ–æ‹’ç»æ•°æ®æ”¶é›†
- æ‹’ç»åä¼šç¦ç”¨ GA è¿½è¸ª
- åŒæ„çŠ¶æ€ä¿å­˜åœ¨ `localStorage` ä¸­

## ğŸ“ˆ æŸ¥çœ‹æ•°æ®

1. ç™»å½• [Google Analytics](https://analytics.google.com/)
2. é€‰æ‹©æ‚¨çš„å±æ€§
3. æŸ¥çœ‹å®æ—¶æ•°æ®ã€å—ä¼—ç¾¤ä½“ã€è¡Œä¸ºç­‰æŠ¥å‘Š

### æ¨èæŠ¥å‘Š

- **å®æ—¶æŠ¥å‘Š**: æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·
- **å—ä¼—ç¾¤ä½“ > æ¦‚è§ˆ**: ç”¨æˆ·åŸºæœ¬ç»Ÿè®¡
- **è¡Œä¸º > äº‹ä»¶**: è‡ªå®šä¹‰äº‹ä»¶è¿½è¸ª
- **è½¬åŒ– > ç›®æ ‡**: è®¾ç½®ä¸šåŠ¡ç›®æ ‡è¿½è¸ª

## ğŸ” è°ƒè¯•

### å¼€å‘ç¯å¢ƒè°ƒè¯•

åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼ŒGA ä¼šè‡ªåŠ¨å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š

```javascript
// æ£€æŸ¥ GA æ˜¯å¦æ­£ç¡®åŠ è½½
console.log('GA å·²åŠ è½½:', window.gtag ? 'æ˜¯' : 'å¦');

// æŸ¥çœ‹æ•°æ®å±‚
console.log('æ•°æ®å±‚:', window.dataLayer);
```

### ä½¿ç”¨ GA è°ƒè¯•æ‰©å±•

1. å®‰è£… [Google Analytics Debugger](https://chrome.google.com/webstore/detail/google-analytics-debugger/jnkmfdileelhofjcijamephohjechhna) Chrome æ‰©å±•
2. æ‰“å¼€æ‰©å±•
3. è®¿é—®æ‚¨çš„ç½‘ç«™
4. åœ¨æ§åˆ¶å°æŸ¥çœ‹ GA äº‹ä»¶è¯¦æƒ…

## âš™ï¸ é…ç½®é€‰é¡¹

ç¼–è¾‘ `config/analytics.ts` æ¥è‡ªå®šä¹‰é…ç½®ï¼š

```typescript
export const GA_CONFIG = {
  // æ˜¯å¦åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨
  enableInDev: true,

  // è‡ªåŠ¨è¿½è¸ªé€‰é¡¹
  autoTrack: {
    pageView: true,
    outbound: true,
    fileDownload: true,
    scroll: true,
  },

  // éšç§è®¾ç½®
  privacy: {
    anonymizeIp: true,
    respectDnt: true,
    requireConsent: false,
  },
};
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å»¶è¿Ÿ**: GA æ•°æ®é€šå¸¸æœ‰ 24-48 å°æ—¶å»¶è¿Ÿ
2. **æµ‹è¯•ç¯å¢ƒ**: å¼€å‘ç¯å¢ƒçš„æ•°æ®ä¼šè¢«è®°å½•ï¼Œå»ºè®®ä½¿ç”¨å•ç‹¬çš„ GA å±æ€§
3. **GDPR åˆè§„**: å¦‚æœæ‚¨çš„ç”¨æˆ·æ¥è‡ªæ¬§ç›Ÿï¼Œè¯·ç¡®ä¿ç¬¦åˆ GDPR è¦æ±‚
4. **æ€§èƒ½å½±å“**: GA è„šæœ¬å¼‚æ­¥åŠ è½½ï¼Œå¯¹æ€§èƒ½å½±å“æå°

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°æ•°æ®ï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

- æµ‹é‡ ID æ˜¯å¦æ­£ç¡®é…ç½®
- æ˜¯å¦é‡å¯äº†å¼€å‘æœåŠ¡å™¨
- æ˜¯å¦æœ‰å¹¿å‘Šæ‹¦æˆªå™¨é˜»æ­¢äº† GA è„šæœ¬
- æ•°æ®å¯èƒ½æœ‰å»¶è¿Ÿï¼Œç­‰å¾…å‡ å°æ—¶åå†æŸ¥çœ‹

### Q: å¦‚ä½•ç¦ç”¨ GAï¼Ÿ

A: è®¾ç½®ç¯å¢ƒå˜é‡ `GA_MEASUREMENT_ID=` ä¸ºç©ºå³å¯ç¦ç”¨ã€‚

### Q: å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒçš„æµ‹é‡ IDï¼Ÿ

A: åœ¨ç”Ÿäº§ç¯å¢ƒçš„ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ä¸åŒçš„ `GA_MEASUREMENT_ID`ã€‚

## ğŸ“š ç›¸å…³èµ„æº

- [Google Analytics 4 æ–‡æ¡£](https://developers.google.com/analytics/devguides/collection/ga4)
- [gtag.js å‚è€ƒ](https://developers.google.com/analytics/devguides/collection/gtagjs)
- [äº‹ä»¶è¿½è¸ªæŒ‡å—](https://developers.google.com/analytics/devguides/collection/ga4/events)
- [éšç§å’Œæ•°æ®ä¿æŠ¤](https://support.google.com/analytics/topic/2919631)
