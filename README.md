# ShortLink - å¼€æºç§æœ‰åŒ–çŸ­é“¾æ¥å¹³å°

<p align="center">
  <strong>ğŸ”— å®Œå…¨å¼€æºã€ä¸€é”®ç§æœ‰åŒ–éƒ¨ç½²çš„çŸ­é“¾æ¥ç®¡ç†ç³»ç»Ÿ</strong>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/License-MIT-green" alt="License">
  <img src="https://img.shields.io/badge/Self--Hosted-âœ“-brightgreen" alt="Self-Hosted">
  <img src="https://img.shields.io/badge/React-18-blue?logo=react" alt="React">
  <img src="https://img.shields.io/badge/Node.js-18-green?logo=node.js" alt="Node.js">
</p>

---

## ğŸ¯ ä¸ºä»€ä¹ˆé€‰æ‹© ShortLinkï¼Ÿ

> **å‘Šåˆ«ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ŒæŒæ§ä½ çš„æ•°æ®ä¸»æƒ**

| å¯¹æ¯”é¡¹ | ç¬¬ä¸‰æ–¹çŸ­é“¾æœåŠ¡ | ShortLink ç§æœ‰åŒ–éƒ¨ç½² |
|--------|---------------|---------------------|
| ğŸ“¦ **æ•°æ®å½’å±** | å­˜å‚¨åœ¨ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ | âœ… å®Œå…¨å­˜å‚¨åœ¨ä½ çš„æœåŠ¡å™¨ |
| ğŸ” **éšç§å®‰å…¨** | å¯èƒ½å­˜åœ¨æ•°æ®æ³„éœ²é£é™© | âœ… å†…ç½‘éš”ç¦»ï¼Œç»å¯¹å®‰å…¨ |
| ğŸ’° **è´¹ç”¨** | æŒ‰é‡ä»˜è´¹ï¼Œæˆæœ¬ä¸å¯æ§ | âœ… ä¸€æ¬¡éƒ¨ç½²ï¼Œæ°¸ä¹…å…è´¹ |
| ğŸ› **å®šåˆ¶åŒ–** | åŠŸèƒ½å—é™ï¼Œæ— æ³•å®šåˆ¶ | âœ… å¼€æºä»£ç ï¼Œè‡ªç”±ä¿®æ”¹ |
| ğŸŒ **è‡ªå®šä¹‰åŸŸå** | éœ€è¦ä»˜è´¹æˆ–é™åˆ¶ä½¿ç”¨ | âœ… æ— é™åˆ¶ç»‘å®šè‡ªæœ‰åŸŸå + è‡ªåŠ¨ SSL |

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° |
|------|------|
| ğŸ”— **çŸ­é“¾ç®¡ç†** | åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤çŸ­é“¾æ¥ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ |
| ğŸŒ **å¤šåŸŸåæ”¯æŒ** | ç»‘å®šè‡ªæœ‰åŸŸåï¼Œè‡ªåŠ¨ç”³è¯· Let's Encrypt SSL è¯ä¹¦ |
| ğŸ” **RBAC æƒé™** | ä¼ä¸šçº§è§’è‰²æƒé™ç³»ç»Ÿ |
| ğŸ“Š **å®¡è®¡æ—¥å¿—** | å®Œæ•´æ“ä½œè®°å½•ï¼Œæ”¯æŒå¯¼å‡ºåˆ†æ |
| ğŸš€ **é«˜æ€§èƒ½** | Redis ç¼“å­˜åŠ é€Ÿï¼Œé‡å®šå‘å»¶è¿Ÿ < 10ms |

---

## ğŸ›  æŠ€æœ¯æ¶æ„ (æ··åˆæ¨¡å¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ”’ Hybrid æ··åˆéƒ¨ç½²                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚   Nginx     â”‚  â—€â”€â”€â”€â”€ å®¿ä¸»æœºï¼ˆåå‘ä»£ç† + SSLï¼‰              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚         â”‚                                                   â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â–¶  Frontend (Docker, ç«¯å£ 3000)               â”‚
â”‚         â”‚                                                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â–¶  Backend (PM2/å®¿ä¸»æœº, ç«¯å£ 5000)             â”‚
â”‚                        â”‚                                    â”‚
â”‚                        â–¼                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚  MongoDB + Redis   â”‚  â—€â”€â”€â”€â”€ Docker å®¹å™¨       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ç»„ä»¶ | è¿è¡Œä½ç½® | è¯´æ˜ |
|------|---------|------|
| **å‰ç«¯** | Docker å®¹å™¨ | ä» GHCR æ‹‰å–é•œåƒï¼Œæ— éœ€åœ¨æœåŠ¡å™¨æ„å»º |
| **åç«¯** | å®¿ä¸»æœº PM2 | éœ€è¦å®¿ä¸»æœºæƒé™æ‰§è¡Œ SSL è¯ä¹¦ç”³è¯· |
| **æ•°æ®åº“** | Docker å®¹å™¨ | MongoDB + Redis |
| **åå‘ä»£ç†** | å®¿ä¸»æœº Nginx | ç»Ÿä¸€å…¥å£ + SSL ç»ˆç»“ |

---

## ğŸ“¦ å®Œæ•´éƒ¨ç½²æŒ‡å—

### ç¯å¢ƒè¦æ±‚

- **æœåŠ¡å™¨**: Linux (Ubuntu 22.04 æ¨è), 1 æ ¸ 1G å†…å­˜èµ·æ­¥
- **åŸŸå**: è‡³å°‘ä¸€ä¸ªå·²è§£æåˆ°æœåŠ¡å™¨ IP çš„åŸŸå
- **è½¯ä»¶**: Docker, Node.js 18+, Nginx, PM2, acme.sh

---

### æ­¥éª¤ 1ï¼šæœåŠ¡å™¨åŸºç¡€ç¯å¢ƒå®‰è£…

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 1. å®‰è£… Docker
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER
# é‡æ–°ç™»å½• SSH ä½¿ docker ç»„ç”Ÿæ•ˆ

# 2. å®‰è£… Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# 3. å®‰è£… Nginx
sudo apt install -y nginx

# 4. å®‰è£… PM2
sudo npm install -g pm2

# 5. å®‰è£… acme.sh (SSL è¯ä¹¦)
curl https://get.acme.sh | sh
source ~/.bashrc

# éªŒè¯å®‰è£…
docker --version && node --version && nginx -v && pm2 --version
```

---

### æ­¥éª¤ 2ï¼šå…‹éš†é¡¹ç›®å¹¶é…ç½®ç¯å¢ƒå˜é‡

```bash
# å…‹éš†é¡¹ç›®
cd /var/www
sudo mkdir -p shortlink && sudo chown $(whoami):$(whoami) shortlink
git clone <your-repository-url> shortlink
cd shortlink

# å¤åˆ¶å¹¶ç¼–è¾‘ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env
```

**å¿…é¡»é…ç½®çš„ `.env` å˜é‡ï¼š**

```bash
# GitHub ç”¨æˆ·åï¼ˆç”¨äºæ‹‰å–å‰ç«¯é•œåƒï¼‰
GITHUB_USERNAME=your_github_username

# JWT å¯†é’¥ï¼ˆç”Ÿæˆï¼šopenssl rand -hex 32ï¼‰
JWT_SECRET=your_super_secure_jwt_secret
```

---

### æ­¥éª¤ 3ï¼šå¯åŠ¨ Docker æœåŠ¡ï¼ˆå‰ç«¯ + æ•°æ®åº“ï¼‰

```bash
# ç™»å½• GitHub Container Registryï¼ˆå¦‚æœé•œåƒæ˜¯ç§æœ‰çš„ï¼‰
echo $GITHUB_TOKEN | docker login ghcr.io -u $GITHUB_USERNAME --password-stdin

# å¯åŠ¨æ‰€æœ‰ Docker æœåŠ¡
docker compose up -d

# éªŒè¯å®¹å™¨è¿è¡Œ
docker ps
# åº”çœ‹åˆ°ï¼šlinkify-frontend, linkify-mongo, linkify-redis
```

> ğŸ’¡ å‰ç«¯é•œåƒç”± GitHub Actions è‡ªåŠ¨æ„å»ºå¹¶æ¨é€åˆ° GHCRï¼ŒæœåŠ¡å™¨åªéœ€æ‹‰å–å³å¯ï¼Œæ— éœ€æœ¬åœ°æ„å»ºã€‚

---

### æ­¥éª¤ 4ï¼šé…ç½®å¹¶å¯åŠ¨åç«¯

```bash
cd /var/www/shortlink/backend

# å®‰è£…ä¾èµ–
npm install

# ç¼–è¾‘ç”Ÿäº§ç¯å¢ƒé…ç½®
# ä»ç¤ºä¾‹æ–‡ä»¶åˆ›å»º
cp .env.example .env.production
nano .env.production

# å¿…é¡»é…ç½®çš„é¡¹ï¼š
# - JWT_SECRETï¼šä½¿ç”¨ openssl rand -hex 32 ç”Ÿæˆ
# - ACME_EMAILï¼šä½ çš„é‚®ç®±ï¼ˆç”¨äºSSLè¯ä¹¦é€šçŸ¥ï¼‰
# - DASHSCOPE_API_KEYï¼šé˜¿é‡Œäº‘AI API Keyï¼ˆå¯é€‰ï¼‰

# ä½¿ç”¨ PM2 å¯åŠ¨
pm2 start ecosystem.config.js --env production

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save

# éªŒè¯
pm2 status
curl http://localhost:5000/api/health
```

---

### æ­¥éª¤ 5ï¼šé…ç½® Nginx

```bash
# å¤‡ä»½é»˜è®¤é…ç½®
sudo mv /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak

# å¤åˆ¶é¡¹ç›® Nginx é…ç½®
sudo cp /var/www/shortlink/backend/nginx/nginx.conf /etc/nginx/nginx.conf

# ç¼–è¾‘é…ç½®ï¼Œæ›¿æ¢å ä½ç¬¦
sudo nano /etc/nginx/nginx.conf
# ä¿®æ”¹ï¼š
# - YOUR_SERVER_IP â†’ ä½ çš„æœåŠ¡å™¨ IP
# - your-domain.com â†’ ä½ çš„åŸŸå
# - www.your-domain.com â†’ å®Œæ•´åŸŸå

# åˆ›å»ºå¿…è¦ç›®å½•
sudo mkdir -p /etc/nginx/ssl /etc/nginx/ssl/domains /var/www/html

# æµ‹è¯•å¹¶é‡å¯
sudo nginx -t
sudo systemctl enable nginx
sudo systemctl restart nginx
```

---

### æ­¥éª¤ 6ï¼šç”³è¯· SSL è¯ä¹¦

```bash
# ç”³è¯·è¯ä¹¦
~/.acme.sh/acme.sh --issue -d your-domain.com -d www.your-domain.com -w /var/www/html

# å®‰è£…è¯ä¹¦
~/.acme.sh/acme.sh --install-cert -d your-domain.com \
  --key-file /etc/nginx/ssl/your-domain.com.key \
  --fullchain-file /etc/nginx/ssl/your-domain.com.pem \
  --reloadcmd "sudo systemctl reload nginx"
```

---

### æ­¥éª¤ 7ï¼šåˆå§‹åŒ–æ•°æ®åº“

```bash
cd /var/www/shortlink/backend
npm run seed:prod
```

---

### æ­¥éª¤ 8ï¼šéªŒè¯éƒ¨ç½²

1. è®¿é—® `https://www.your-domain.com`
2. ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•ï¼š
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`admin123`
3. **ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼**

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ›´æ–°å‰ç«¯ï¼ˆDocker é•œåƒï¼‰

```bash
cd /var/www/shortlink
docker compose pull frontend
docker compose up -d frontend
```

### æ›´æ–°åç«¯

```bash
cd /var/www/shortlink
git pull
cd backend && npm install
pm2 restart shortlink-backend
```

---

## ğŸ”§ æ—¥å¸¸ç»´æŠ¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status
docker ps

# æŸ¥çœ‹æ—¥å¿—
pm2 logs shortlink-backend
docker logs linkify-frontend

# æ•°æ®åº“å¤‡ä»½
cd /var/www/shortlink/backend
npm run backup

# è®¾ç½®è‡ªåŠ¨å¤‡ä»½
npm run setup-backup
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
shortlink/
â”œâ”€â”€ frontend/              # å‰ç«¯ (Docker é•œåƒ)
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ backend/               # åç«¯ (PM2 è¿è¡Œ)
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ nginx/nginx.conf   # Nginx é…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ ecosystem.config.js
â”‚   â””â”€â”€ .env.production
â”œâ”€â”€ docker-compose.yml     # Docker ç¼–æ’
â””â”€â”€ .env.example           # ç¯å¢ƒå˜é‡æ¨¡æ¿
```

---

## ğŸ›¡ å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
2. **è®¾ç½®é˜²ç«å¢™**ï¼šåªå¼€æ”¾ 80/443 ç«¯å£
3. **å®šæœŸå¤‡ä»½**ï¼š`npm run setup-backup`
4. **ä¿æŠ¤é…ç½®æ–‡ä»¶**ï¼š`chmod 600 .env*`

---

## ğŸ“„ License

[MIT License](LICENSE)
